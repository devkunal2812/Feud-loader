<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="CURET - Where Rivalries Rise. Experience the ultimate arena at PRKARSH 2026, presented by PRAXIS.">
<meta name="theme-color" content="#000000">
<title>CURET — PRKARSH 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { 
  margin: 0; 
  padding: 0; 
  box-sizing: border-box;
}

*::selection {
  background: var(--blue-bright);
  color: var(--white);
}

:root {
  --blue:       #3366ff;
  --blue-bright:#4d7fff;
  --pink:       #ff1493;
  --pink-hot:   #ff69b4;
  --white:      #f8f0ff;
  --silver:     #c8aad8;
  --bg:         #000000;
}

html, body {
  width: 100%; 
  height: 100%;
  overflow: hidden;
  background: var(--bg);
  font-family: 'Rajdhani', sans-serif;
  cursor: none;
}

@media (max-width: 768px) {
  html, body {
    cursor: auto;
  }
}

/* ── CANVAS (particles) ── */
#canvas {
  position: fixed; 
  inset: 0; 
  z-index: 0;
  pointer-events: none;
}

/* ── BOTTOM GLOW ── */
.bottom-glow {
  position: fixed;
  bottom: 0; 
  left: 0; 
  right: 0;
  height: 55%;
  background:
    radial-gradient(ellipse 90% 70% at 60% 110%, rgba(51,102,255,.45) 0%, transparent 65%),
    radial-gradient(ellipse 60% 50% at 20% 110%, rgba(255,20,147,.35) 0%, transparent 60%),
    radial-gradient(ellipse 100% 40% at 50% 130%, rgba(77,127,255,.25) 0%, transparent 55%);
  z-index: 1;
  pointer-events: none;
  animation: glowBreath 5s ease-in-out infinite alternate;
}

@media (max-width: 768px) {
  .bottom-glow {
    height: 45%;
    background:
      radial-gradient(ellipse 120% 80% at 50% 110%, rgba(51,102,255,.4) 0%, transparent 65%),
      radial-gradient(ellipse 80% 60% at 30% 110%, rgba(255,20,147,.3) 0%, transparent 60%);
  }
}

@keyframes glowBreath {
  from { opacity: .9; transform: scaleY(1); }
  to   { opacity: 1;   transform: scaleY(1.08); }
}

/* ── VIGNETTE ── */
.vignette {
  position: fixed; 
  inset: 0; 
  z-index: 2;
  background: radial-gradient(ellipse at 50% 40%,
    transparent 20%,
    rgba(0,0,0,.5) 65%,
    rgba(0,0,0,.9) 100%);
  pointer-events: none;
}

/* ── SCANLINE ── */
.scanline {
  position: fixed; 
  left: 0; 
  width: 100%; 
  height: 3px;
  background: linear-gradient(to bottom, 
    transparent, 
    rgba(51,102,255,.08), 
    rgba(77,127,255,.12),
    rgba(51,102,255,.08),
    transparent);
  z-index: 3; 
  pointer-events: none;
  animation: scanMove 8s linear infinite;
  opacity: .7;
}

@keyframes scanMove {
  from { top: -2%; }
  to   { top: 102%; }
}

/* ── CURSOR ── */
.cursor {
  position: fixed; 
  width: 10px; 
  height: 10px;
  border: 1px solid var(--blue-bright);
  border-radius: 50%;
  pointer-events: none; 
  z-index: 9999;
  transform: translate(-50%, -50%);
  box-shadow: 0 0 8px var(--blue-bright);
}

@media (max-width: 768px) {
  .cursor {
    display: none;
  }
}

/* ── STAGE ── */
#stage {
  position: fixed; 
  inset: 0; 
  z-index: 10;
  display: flex; 
  flex-direction: column;
  align-items: center; 
  justify-content: center;
}

.phase {
  position: absolute;
  display: flex; 
  flex-direction: column;
  align-items: center; 
  justify-content: center;
  width: 100%; 
  padding: 0 24px;
  opacity: 0;
  pointer-events: none;
}

@media (max-width: 480px) {
  .phase {
    padding: 0 16px;
  }
}

/* ── PHASE 1 ── */
#ph1 { 
  gap: 10px;
  transform: scale(0.8);
}

#ph1 .event-name {
  font-family: 'Orbitron', sans-serif;
  font-size: clamp(22px, 5vw, 54px);
  font-weight: 900;
  letter-spacing: clamp(8px, 2vw, 16px);
  color: var(--white);
  text-shadow: 0 0 30px rgba(77,127,255,.3), 0 0 80px rgba(51,102,255,.2);
  text-align: center;
}

#ph1 .year-label {
  font-size: clamp(9px, 1.3vw, 13px);
  letter-spacing: clamp(4px, 1vw, 7px);
  color: var(--silver);
  text-transform: uppercase;
  opacity: .65;
  text-align: center;
}

@media (max-width: 480px) {
  #ph1 { gap: 6px; }
  
  #ph1 .event-name {
    font-size: clamp(20px, 8vw, 32px);
    letter-spacing: clamp(4px, 3vw, 10px);
  }
  
  #ph1 .year-label {
    font-size: clamp(8px, 2.5vw, 11px);
    letter-spacing: clamp(2px, 1.5vw, 5px);
  }
}

@keyframes zoomIn {
  from {
    transform: scale(0.8);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

@keyframes zoomOut {
  from {
    transform: scale(1);
    opacity: 1;
  }
  to {
    transform: scale(1.2);
    opacity: 0;
  }
}

/* ── PHASE 2 ── */
#ph2 { 
  gap: 8px;
  transform: scale(0.8);
}

#ph2 .club {
  font-family: 'Orbitron', sans-serif;
  font-size: clamp(18px, 4vw, 42px);
  font-weight: 700;
  letter-spacing: clamp(6px, 1.5vw, 12px);
  color: var(--blue-bright);
  text-shadow:
    0 0 15px var(--blue-bright),
    0 0 50px var(--blue),
    0 0 100px rgba(51,102,255,.5);
  text-align: center;
}

#ph2 .presents {
  font-size: clamp(10px, 1.5vw, 15px);
  letter-spacing: clamp(4px, 1.2vw, 8px);
  color: var(--silver);
  text-transform: uppercase;
  opacity: .75;
  text-align: center;
}

@media (max-width: 480px) {
  #ph2 { gap: 6px; }
  
  #ph2 .club {
    font-size: clamp(24px, 7vw, 36px);
    letter-spacing: clamp(4px, 2vw, 10px);
  }
  
  #ph2 .presents {
    font-size: clamp(9px, 2.5vw, 13px);
    letter-spacing: clamp(2px, 1.5vw, 6px);
  }
}

/* ── CRACK LINE ── */
#crack {
  position: fixed;
  width: 2px; 
  height: 0;
  background: linear-gradient(to bottom,
    transparent 0%,
    var(--blue-bright) 15%,
    var(--pink-hot) 50%,
    var(--blue-bright) 85%,
    transparent 100%);
  box-shadow:
    0 0 15px var(--blue-bright),
    0 0 35px var(--blue),
    0 0 80px rgba(51,102,255,.7),
    0 0 120px rgba(255,20,147,.5);
  left: 50%; 
  top: 0;
  transform: translateX(-50%);
  z-index: 15; 
  opacity: 0;
}

/* ── PHASE 3 ── */
#ph3 { 
  gap: 8px;
  transform: scale(0.8);
}

.logo-container {
  width: clamp(250px, 35vw, 500px);
  max-width: 90vw;
  height: auto;
  position: relative;
  filter: drop-shadow(0 0 20px rgba(51,102,255,.6))
          drop-shadow(0 0 40px rgba(255,20,147,.4))
          drop-shadow(0 0 80px rgba(51,102,255,.3));
  transform: scale(1);
  transition: transform 0.3s ease;
}

.logo-container:hover {
  transform: scale(1.05);
}

.logo-container img {
  width: 100%;
  height: auto;
  display: block;
  object-fit: contain;
}

@media (max-width: 480px) {
  .logo-container {
    width: clamp(180px, 70vw, 300px);
  }
}

@media (min-width: 481px) and (max-width: 768px) {
  .logo-container {
    width: clamp(220px, 55vw, 380px);
  }
}

@media (min-width: 769px) and (max-width: 1024px) {
  .logo-container {
    width: clamp(280px, 40vw, 450px);
  }
}

@media (min-width: 1920px) {
  .logo-container {
    width: clamp(350px, 30vw, 550px);
  }
}

@media (min-width: 2560px) {
  .logo-container {
    width: clamp(450px, 28vw, 650px);
  }
}

.tagline {
  font-family: 'Rajdhani', sans-serif;
  font-size: clamp(10px, 1.6vw, 16px);
  letter-spacing: clamp(4px, 1vw, 7px);
  color: var(--pink-hot);
  text-transform: uppercase;
  opacity: .8;
  margin-top: 10px;
  text-shadow: 0 0 20px var(--pink);
  text-align: center;
}

@media (max-width: 480px) {
  .tagline {
    font-size: clamp(9px, 3vw, 13px);
    letter-spacing: clamp(2px, 1.5vw, 5px);
    margin-top: 8px;
  }
}

/* ── LOADER ── */
.loader-wrap {
  margin-top: clamp(20px, 4.5vw, 50px);
  display: flex; 
  flex-direction: column;
  align-items: center; 
  gap: 12px;
  width: clamp(200px, 48vw, 460px);
  padding: 0 20px;
}

@media (max-width: 480px) {
  .loader-wrap {
    margin-top: clamp(16px, 5vw, 30px);
    gap: 10px;
    width: clamp(240px, 80vw, 320px);
    padding: 0 16px;
  }
}

@media (min-width: 481px) and (max-width: 768px) {
  .loader-wrap {
    width: clamp(280px, 65vw, 380px);
  }
}

.loader-label {
  font-size: clamp(10px, 1.2vw, 12px);
  letter-spacing: 5px;
  color: var(--silver);
  text-transform: uppercase;
  opacity: .65;
}

@media (max-width: 480px) {
  .loader-label {
    font-size: clamp(8px, 2.5vw, 11px);
    letter-spacing: 3px;
  }
}

.bar-track {
  width: 100%; 
  height: 2px;
  background: rgba(255,255,255,.06);
  position: relative; 
  overflow: visible;
}

@media (max-width: 480px) {
  .bar-track {
    height: 3px;
  }
}

.bar-fill {
  height: 100%; 
  width: 0%;
  background: linear-gradient(90deg, var(--blue), var(--blue-bright), var(--pink-hot));
  box-shadow:
    0 0 8px var(--blue-bright),
    0 0 20px var(--blue),
    0 0 40px rgba(51,102,255,.5);
  position: relative;
}

.bar-fill::after {
  content: '';
  position: absolute;
  right: -1px; 
  top: -5px;
  width: 3px; 
  height: 12px;
  background: linear-gradient(to bottom, var(--blue-bright), #fff, var(--blue-bright));
  box-shadow: 0 0 15px #fff, 0 0 30px var(--blue-bright), 0 0 45px var(--blue);
  animation: barTipGlow 1.5s ease-in-out infinite;
}

@keyframes barTipGlow {
  0%, 100% {
    box-shadow: 0 0 15px #fff, 0 0 30px var(--blue-bright), 0 0 45px var(--blue);
  }
  50% {
    box-shadow: 0 0 25px #fff, 0 0 50px var(--blue-bright), 0 0 70px var(--blue);
  }
}

.bar-ticks {
  position: absolute; 
  inset: 0;
  display: flex; 
  justify-content: space-between; 
  align-items: center;
  pointer-events: none;
}

.tick {
  width: 1px; 
  height: 6px;
  background: rgba(255,255,255,.12);
  margin-top: 8px;
}

.pct-label {
  font-family: 'Orbitron', sans-serif;
  font-size: clamp(9px, 1.1vw, 11px);
  letter-spacing: 3px;
  color: var(--blue-bright);
  align-self: flex-end;
  text-shadow: 0 0 12px var(--blue);
}

@media (max-width: 480px) {
  .pct-label {
    font-size: clamp(9px, 2.5vw, 11px);
    letter-spacing: 2px;
  }
}

/* ── ENTER TEXT ── */
.enter-text {
  font-family: 'Orbitron', sans-serif;
  font-size: clamp(12px, 1.8vw, 18px);
  letter-spacing: 9px;
  color: var(--white);
  text-shadow:
    0 0 15px var(--blue-bright),
    0 0 40px var(--blue),
    0 0 80px rgba(51,102,255,.5);
  text-transform: uppercase;
  margin-top: 6px;
  opacity: 0;
  transform: translateY(12px) scale(0.9);
  transition: opacity .9s ease, transform .9s ease;
  animation: enterPulse 2s ease-in-out infinite;
}

@media (max-width: 480px) {
  .enter-text {
    font-size: clamp(10px, 3.5vw, 15px);
    letter-spacing: clamp(3px, 1.5vw, 6px);
    margin-top: 8px;
  }
}

.enter-text.show { 
  opacity: 1; 
  transform: translateY(0) scale(1); 
}

@keyframes enterPulse {
  0%,100% { 
    text-shadow: 0 0 15px var(--blue-bright), 0 0 40px var(--blue);
    transform: scale(1);
  }
  50% { 
    text-shadow: 0 0 25px var(--blue-bright), 0 0 70px var(--blue), 0 0 120px rgba(51,102,255,.6);
    transform: scale(1.05);
  }
}

/* ── KEYFRAMES ── */
@keyframes pulseGlow {
  0%,100% {
    filter: drop-shadow(0 0 20px rgba(51,102,255,.6))
            drop-shadow(0 0 40px rgba(255,20,147,.4))
            drop-shadow(0 0 80px rgba(51,102,255,.3));
    transform: scale(1);
  }
  50% {
    filter: drop-shadow(0 0 35px rgba(51,102,255,.8))
            drop-shadow(0 0 70px rgba(255,20,147,.6))
            drop-shadow(0 0 140px rgba(51,102,255,.5));
    transform: scale(1.03);
  }
}

@keyframes flicker {
  0%,88%,90%,92%,94%,100% { opacity: 1; }
  89% { opacity: .4; }
  91% { opacity: .7; }
  93% { opacity: .85; }
}

/* ── HOMEPAGE ── */
#homepage {
  position: fixed; 
  inset: 0; 
  z-index: 5;
  background: #000;
  display: flex; 
  flex-direction: column;
  align-items: center; 
  justify-content: center;
  opacity: 0; 
  pointer-events: none;
  transition: opacity 1.4s ease;
  transform: scale(0.95);
}

#homepage.visible { 
  opacity: 1; 
  pointer-events: all;
  animation: homepageZoom 1.4s ease forwards;
}

@keyframes homepageZoom {
  from {
    transform: scale(0.95);
  }
  to {
    transform: scale(1);
  }
}

#homepage .hp-glow {
  position: absolute; 
  bottom: 0; 
  left: 0; 
  right: 0; 
  height: 55%;
  background:
    radial-gradient(ellipse 80% 60% at 55% 120%, rgba(51,102,255,.5) 0%, transparent 60%),
    radial-gradient(ellipse 50% 40% at 20% 120%, rgba(255,20,147,.35) 0%, transparent 55%);
  pointer-events: none;
  animation: glowBreath 5s ease-in-out infinite alternate;
}

#homepage .hp-logo {
  width: clamp(280px, 40vw, 550px);
  max-width: 85vw;
  height: auto;
  filter: drop-shadow(0 0 30px rgba(51,102,255,.7))
          drop-shadow(0 0 60px rgba(255,20,147,.5));
  position: relative; 
  z-index: 1;
  object-fit: contain;
  animation: logoFloat 3s ease-in-out infinite;
}

@keyframes logoFloat {
  0%, 100% {
    transform: translateY(0) scale(1);
    filter: drop-shadow(0 0 30px rgba(51,102,255,.7))
            drop-shadow(0 0 60px rgba(255,20,147,.5));
  }
  50% {
    transform: translateY(-12px) scale(1.02);
    filter: drop-shadow(0 0 40px rgba(51,102,255,.9))
            drop-shadow(0 0 80px rgba(255,20,147,.7));
  }
}

@media (max-width: 480px) {
  #homepage .hp-logo {
    width: clamp(200px, 70vw, 320px);
  }
}

@media (min-width: 481px) and (max-width: 768px) {
  #homepage .hp-logo {
    width: clamp(240px, 60vw, 400px);
  }
}

@media (min-width: 769px) and (max-width: 1024px) {
  #homepage .hp-logo {
    width: clamp(300px, 45vw, 480px);
  }
}

@media (min-width: 1920px) {
  #homepage .hp-logo {
    width: clamp(380px, 35vw, 600px);
  }
}

@media (min-width: 2560px) {
  #homepage .hp-logo {
    width: clamp(480px, 32vw, 700px);
  }
}

#homepage p {
  font-family: 'Rajdhani', sans-serif;
  font-size: clamp(11px, 1.4vw, 15px);
  letter-spacing: 6px;
  color: var(--pink-hot);
  margin-top: 20px;
  opacity: .7;
  position: relative; 
  z-index: 1;
  text-shadow: 0 0 20px var(--pink), 0 0 40px rgba(255,20,147,.4);
  animation: textGlow 3s ease-in-out infinite;
}

@keyframes textGlow {
  0%, 100% {
    text-shadow: 0 0 20px var(--pink), 0 0 40px rgba(255,20,147,.4);
  }
  50% {
    text-shadow: 0 0 30px var(--pink), 0 0 60px rgba(255,20,147,.6);
  }
}

@media (max-width: 480px) {
  #homepage p {
    font-size: clamp(10px, 3vw, 13px);
    letter-spacing: clamp(2px, 1.5vw, 4px);
    margin-top: 16px;
  }
}

#homepage .hp-line {
  width: 180px; 
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--blue-bright), transparent);
  margin: 24px auto;
  box-shadow: 0 0 15px var(--blue), 0 0 30px rgba(51,102,255,.4);
  position: relative; 
  z-index: 1;
  animation: lineGlow 2s ease-in-out infinite;
}

@keyframes lineGlow {
  0%, 100% {
    box-shadow: 0 0 15px var(--blue), 0 0 30px rgba(51,102,255,.4);
  }
  50% {
    box-shadow: 0 0 25px var(--blue), 0 0 50px rgba(51,102,255,.6);
  }
}

@media (max-width: 480px) {
  #homepage .hp-line {
    width: 120px;
    margin: 18px auto;
  }
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>
<div class="bottom-glow"></div>
<div class="vignette"></div>
<div class="scanline"></div>
<div class="cursor" id="cursor"></div>

<!-- ── LOADING STAGE ── -->
<div id="stage">
  <div class="phase" id="ph1">
    <div class="event-name">PRKARSH 2026</div>
    <div class="year-label">Annual Cultural Festival</div>
  </div>

  <div class="phase" id="ph2">
    <div class="club">PRAXIS</div>
    <div class="presents">presents</div>
  </div>

  <div class="phase" id="ph3">
    <div class="logo-container" id="logoContainer">
      <img src="feud-logo.png" alt="CURET" id="curetLogo">
    </div>
    <div class="tagline">Where Rivalries Rise.</div>
    
    <div class="loader-wrap" id="loaderWrap" style="opacity:0; transform: scale(0.9)">
      <div class="loader-label" id="loaderLabel">Initializing Arena...</div>
      <div class="bar-track">
        <div class="bar-fill" id="barFill"></div>
        <div class="bar-ticks">
          <div class="tick"></div>
          <div class="tick"></div>
          <div class="tick"></div>
          <div class="tick"></div>
          <div class="tick"></div>
          <div class="tick"></div>
          <div class="tick"></div>
          <div class="tick"></div>
          <div class="tick"></div>
          <div class="tick"></div>
          <div class="tick"></div>
        </div>
      </div>
      <div class="pct-label" id="pctLabel">0%</div>
      <div class="enter-text" id="enterText">Enter the Arena</div>
    </div>
  </div>
</div>

<div id="crack"></div>

<!-- ── HOMEPAGE ── -->
<div id="homepage">
  <div class="hp-glow"></div>
  <div class="hp-line"></div>
  <img src="feud-logo.png" alt="CURET" class="hp-logo">
  <p>The Arena Awaits You.</p>
  <div class="hp-line"></div>
</div>

<script>
/* ── CURSOR ── */
const cursor = document.getElementById('cursor');
document.addEventListener('mousemove', e => {
  cursor.style.left = e.clientX + 'px';
  cursor.style.top  = e.clientY + 'px';
});

/* ── CANVAS PARTICLES ── */
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

function resize() { 
  canvas.width = window.innerWidth; 
  canvas.height = window.innerHeight; 
}
resize();
window.addEventListener('resize', resize);

// Responsive particle count based on screen size
function getParticleCount() {
  const width = window.innerWidth;
  if (width < 768) return 180;
  if (width < 1440) return 280;
  return 380;
}

let dots = [];

function createParticles() {
  const DOT_COUNT = getParticleCount();
  dots = Array.from({ length: DOT_COUNT }, () => {
    const col = Math.random() > .5;
    const size = Math.random();
    return {
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      r: size < 0.7 ? Math.random() * 1.2 + 0.4 : Math.random() * 2 + 1.5,
      vx: (Math.random() - .5) * .2,
      vy: (Math.random() - .5) * .15,
      alpha: Math.random() * .6 + .2,
      color: col
        ? `rgba(${51 + Math.random()*50|0},${102 + Math.random()*50|0},255,1)`
        : `rgba(255,${20+Math.random()*60|0},${147+Math.random()*50|0},1)`,
      twinkle: Math.random() * Math.PI * 2,
      twinkleSpeed: .01 + Math.random() * .025,
      blur: size < 0.7 ? 4 : 8,
    };
  });
}

createParticles();

function drawDots() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  dots.forEach(d => {
    d.x += d.vx; 
    d.y += d.vy;
    d.twinkle += d.twinkleSpeed;
    
    if (d.x < -10) d.x = canvas.width + 10;
    if (d.x > canvas.width + 10) d.x = -10;
    if (d.y < -10) d.y = canvas.height + 10;
    if (d.y > canvas.height + 10) d.y = -10;
    
    const a = d.alpha * (.65 + .35 * Math.sin(d.twinkle));
    ctx.beginPath();
    ctx.arc(d.x, d.y, d.r, 0, Math.PI * 2);
    ctx.fillStyle = d.color;
    ctx.globalAlpha = a;
    ctx.shadowBlur = d.blur;
    ctx.shadowColor = d.color;
    ctx.fill();
  });
  ctx.globalAlpha = 1;
  requestAnimationFrame(drawDots);
}

// Recreate particles on resize
let resizeTimeout;
window.addEventListener('resize', () => {
  clearTimeout(resizeTimeout);
  resizeTimeout = setTimeout(() => {
    resize();
    createParticles();
  }, 250);
});

drawDots();

/* ── READINESS TRACKER ── */
const readiness = {
  domInteractive : false,
  domComplete    : false,
  fontsReady     : false,
  imagesReady    : false,
  windowLoad     : false,
};

let _resolveReady;
const pageReadyPromise = new Promise(r => { _resolveReady = r; });

function computeScore() {
  const weights = {
    domInteractive: 20,
    domComplete:    30,
    fontsReady:     20,
    imagesReady:    15,
    windowLoad:     15,
  };
  let total = 0;
  for (const [key, val] of Object.entries(readiness)) {
    if (val) total += weights[key];
  }
  return total;
}

function markReady(signal) {
  if (readiness[signal]) return;
  readiness[signal] = true;
  if (Object.values(readiness).every(Boolean)) {
    _resolveReady();
  }
}

function checkReadyState() {
  if (document.readyState === 'interactive' || document.readyState === 'complete') {
    markReady('domInteractive');
  }
  if (document.readyState === 'complete') {
    markReady('domComplete');
  }
}
checkReadyState();
document.addEventListener('readystatechange', checkReadyState);

if (document.fonts && document.fonts.ready) {
  document.fonts.ready.then(() => markReady('fontsReady'));
} else {
  setTimeout(() => markReady('fontsReady'), 1000);
}

function checkImages() {
  const imgs = Array.from(document.images);
  if (imgs.length === 0) { markReady('imagesReady'); return; }
  let loaded = 0;
  const done = () => { if (++loaded >= imgs.length) markReady('imagesReady'); };
  imgs.forEach(img => {
    if (img.complete) done();
    else { 
      img.addEventListener('load', done); 
      img.addEventListener('error', done); 
    }
  });
}
checkImages();

if (document.readyState === 'complete') {
  markReady('windowLoad');
} else {
  window.addEventListener('load', () => markReady('windowLoad'));
}

const SAFETY_TIMEOUT = 12000;
const safetyTimer = setTimeout(() => {
  Object.keys(readiness).forEach(k => markReady(k));
}, SAFETY_TIMEOUT);
pageReadyPromise.then(() => clearTimeout(safetyTimer));

/* ── PROGRESS BAR ── */
let _currentDisplayPct = 0;
let _targetPct         = 0;
let _barAnimFrame;
let _pageIsReady       = false;

pageReadyPromise.then(() => { _pageIsReady = true; });

function tickBar() {
  if (_currentDisplayPct < _targetPct) {
    const diff = _targetPct - _currentDisplayPct;
    _currentDisplayPct += Math.max(0.2, diff * 0.04);
    if (_currentDisplayPct > _targetPct) _currentDisplayPct = _targetPct;
    
    const pct = Math.floor(_currentDisplayPct);
    barFill.style.width = pct + '%';
    pctLabel.textContent = pct + '%';
    
    if (pct > 30 && pct <= 60) loaderLabel.textContent = 'Calibrating Systems...';
    if (pct > 60 && pct <= 85) loaderLabel.textContent = 'Deploying Arena...';
    if (pct > 85)              loaderLabel.textContent = 'Arena Online.';
  }
  _barAnimFrame = requestAnimationFrame(tickBar);
}

function pollReadiness() {
  const realScore = computeScore();
  const mapped = Math.floor(realScore * 0.99);
  if (mapped > _targetPct) _targetPct = mapped;
  
  if (_pageIsReady && _targetPct < 100) {
    _targetPct = 100;
  }
  
  if (_targetPct < 100) setTimeout(pollReadiness, 150);
}

/* ── ANIMATION HELPERS ── */
const ph1 = document.getElementById('ph1');
const ph2 = document.getElementById('ph2');
const ph3 = document.getElementById('ph3');
const crack       = document.getElementById('crack');
const logoContainer = document.getElementById('logoContainer');
const loaderWrap  = document.getElementById('loaderWrap');
const barFill     = document.getElementById('barFill');
const pctLabel    = document.getElementById('pctLabel');
const loaderLabel = document.getElementById('loaderLabel');
const enterText   = document.getElementById('enterText');
const homepage    = document.getElementById('homepage');
const stage       = document.getElementById('stage');

const fadeIn  = (el, dur=800, delay=0) => new Promise(res => {
  setTimeout(() => {
    el.style.transition = `opacity ${dur}ms ease, transform ${dur}ms ease`;
    el.style.opacity = '1';
    el.style.transform = 'scale(1)';
    setTimeout(res, dur);
  }, delay);
});

const fadeOut = (el, dur=600, delay=0) => new Promise(res => {
  setTimeout(() => {
    el.style.transition = `opacity ${dur}ms ease, transform ${dur}ms ease`;
    el.style.opacity = '0';
    el.style.transform = 'scale(1.2)';
    setTimeout(res, dur);
  }, delay);
});

const wait = ms => new Promise(r => setTimeout(r, ms));

function glitchEffect(el, times=3) {
  return new Promise(res => {
    let count = 0;
    const go = () => {
      el.style.transition = 'none';
      el.style.transform = `translateX(${(Math.random()-.5)*14}px)`;
      el.style.filter    = `brightness(1.8) saturate(1.5) hue-rotate(${Math.random()*30-15}deg)`;
      el.style.opacity   = Math.random() > .4 ? '1' : '.25';
      
      setTimeout(() => {
        el.style.transform = 'translateX(0)';
        el.style.filter    = 'none';
        el.style.opacity   = '1';
        if (++count < times) setTimeout(go, 70 + Math.random()*60);
        else setTimeout(res, 80);
      }, 55 + Math.random()*55);
    };
    go();
  });
}

function animateCrack() {
  return new Promise(res => {
    crack.style.opacity = '1';
    crack.style.transition = 'height .8s cubic-bezier(.2,1,.4,1)';
    requestAnimationFrame(() => {
      crack.style.height = '100vh';
      setTimeout(() => {
        document.body.style.transition = 'background .06s';
        document.body.style.background = '#0a0020';
        setTimeout(() => {
          document.body.style.background = '#000';
          setTimeout(res, 350);
        }, 90);
      }, 800);
    });
  });
}

function waitForBarComplete() {
  return new Promise(res => {
    const check = () => {
      if (Math.floor(_currentDisplayPct) >= 100) {
        barFill.style.width = '100%';
        pctLabel.textContent = '100%';
        cancelAnimationFrame(_barAnimFrame);
        res();
      } else {
        requestAnimationFrame(check);
      }
    };
    check();
  });
}

/* ── MAIN SEQUENCE ── */
async function run() {
  await wait(400);
  
  // Phase 1: PRKARSH 2026
  await fadeIn(ph1, 1000);
  await wait(1600);
  await fadeOut(ph1, 800);
  await wait(250);
  
  // Phase 2: PRAXIS presents
  await fadeIn(ph2, 800);
  await glitchEffect(ph2, 3);
  await wait(1200);
  await fadeOut(ph2, 800);
  await wait(400);
  
  // Lightning crack
  await animateCrack();
  crack.style.transition = 'opacity .35s ease';
  crack.style.opacity = '0';
  await wait(150);
  
  // Phase 3: Logo reveal
  await fadeIn(ph3, 700);
  await wait(200);
  await glitchEffect(logoContainer, 5);
  logoContainer.style.animation = 'pulseGlow 2.5s ease-in-out infinite, flicker 8s ease-in-out infinite';
  
  // Show loader
  loaderWrap.style.transition = 'opacity .6s ease, transform .6s ease';
  loaderWrap.style.transform = 'scale(1)';
  loaderWrap.style.opacity = '1';
  await wait(500);
  
  pollReadiness();
  tickBar();
  
  await waitForBarComplete();
  await wait(400);
  
  enterText.classList.add('show');
  await wait(1800);
  
  // Transition to homepage
  stage.style.transition = 'opacity 1.3s ease';
  stage.style.opacity = '0';
  await wait(500);
  homepage.classList.add('visible');
  await wait(1400);
  stage.style.display = 'none';
  
  document.body.style.cursor = 'auto';
  document.body.style.overflow = 'auto';
}

run();
</script>

</body>
</html>
